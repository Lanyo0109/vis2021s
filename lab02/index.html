<!DOCTYPE html>
<!-- saved from url=(0063)file:///C:/Users/LAB1223/Desktop/vis2021s-main/lab02/index.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script src="./index_files/d3.v4.js.下載"></script>
        <script src="./index_files/dataLoader.js.下載"></script>
        <script src="./index_files/getNode.js.下載"></script>
		
		<style>
      		@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@900&display=swap');

		    div, ul {
		      border: solid black 1px;
		      margin: 5px;
		      padding: 10px;
		      background-color: rgba(255, 255, 128, 0.1);
		    }

		    div:hover, ul:hover {
		      background-color: rgba(255, 128, 128, 0.1);
		    }

			html, body {
				height: 100%;
				width: 100%;
				padding: 0;
				margin: 0;
				padding: 10px;
		        background-color: rgba(255, 255, 0, 0.02);
			}

			svg {
		        font-family: 'Noto Serif JP', serif;
			}

			#dropfile {
				height: 5%;
				width: 100%;
				border-style: dotted;;
				display: block;
				text-align: center;
			    animation-name: oxxo;
			    animation-duration: 2s;
			    animation-iteration-count: infinite;
			    padding: 10px;
		        background-color: rgba(255, 255, 0, 0.1);
		        font-family: 'Noto Serif JP', serif;
		        margin-bottom: 10px;
			}
			#dropfile:hover {
			    background-color: rgba(128, 255, 255, 0.1);
			}
			@keyframes oxxo{
			    from {
			        border-style: dotted;;
			        border-color: blue;
			        color: blue;
			    }
			    to {
			        border-style: solid;
			        border-color: red;
			        color: crimson;
			    }
			}
			
			#treemap {
				height: 95%;
				width: 100%;
			}
		</style>
	</head>
	<body>
		<div>
			Lab 02 treemap
		</div>
		<ul>
			<li>遠距教學授課防疫演練: 2021.03.18 (四) </li>
			<li>上台報告: 2021.04.01 (四) </li>
			<li><a href="https://www.d3-graph-gallery.com/graph/treemap_custom.html">Treemap customization in d3.js</a></li>
			<li><a href="http://blog.infographics.tw/2015/10/d3js-tutorial-treemap-and-budget/">D3.js 實戰 － 利用 Treemap Layout 將政府預算視覺化</a></li>
		</ul>

		<div id="dropfile" for="csvfile">
			CSV 資料扔過來! Drop your CSV here.
		</div>
		<div>
			<select id="ObjectKeys"><option value="職業">職業</option><option value="男(千人)">男(千人)</option><option value="女(千人)">女(千人)</option><option value="總人數(千人)">總人數(千人)</option><option value="百分比(%)">百分比(%)</option></select>
		</div>
		<div id="treemap"><svg width="961" height="915"><g><rect x="0" y="70" width="229.5535455941907" height="91.20020866824524" style="stroke: red; fill: rgb(177, 157, 76); opacity: 0.624658;"></rect><rect x="0" y="166.20020866824524" width="229.5535455941907" height="67.97491823530811" style="stroke: red; fill: rgb(177, 157, 76); opacity: 0.564384;"></rect><rect x="234.5535455941907" y="70" width="162.77347996089932" height="164.17512690355332" style="stroke: red; fill: rgb(177, 157, 76); opacity: 0.689041;"></rect><rect x="402.32702555509" y="70" width="69.09842899036454" height="164.1751269035532" style="stroke: red; fill: rgb(177, 157, 76); opacity: 0.513699;"></rect><rect x="0" y="274.1751269035533" width="227.64474685883224" height="135.22409692284828" style="stroke: red; fill: rgb(189, 179, 18); opacity: 0.712329;"></rect><rect x="0" y="414.39922382640157" width="227.64474685883224" height="128.39084143828302" style="stroke: red; fill: rgb(189, 179, 18); opacity: 0.69589;"></rect><rect x="232.64474685883224" y="274.1751269035533" width="238.78070768662232" height="206.52852980550222" style="stroke: red; fill: rgb(189, 179, 18); opacity: 0.908219;"></rect><rect x="232.64474685883224" y="485.7036567090555" width="238.78070768662232" height="57.08640855562908" style="stroke: red; fill: rgb(189, 179, 18); opacity: 0.531507;"></rect><rect x="0" y="582.7900652646846" width="227.2733182222942" height="142.88645815742336" style="stroke: red; fill: rgb(86, 106, 194); opacity: 0.724658;"></rect><rect x="0" y="730.676523422108" width="227.2733182222942" height="164.32347657789205" style="stroke: red; fill: rgb(86, 106, 194); opacity: 0.775342;"></rect><rect x="232.2733182222942" y="582.7900652646846" width="239.15213632316036" height="246.4805086411601" style="stroke: red; fill: rgb(86, 106, 194); opacity: 1;"></rect><rect x="232.2733182222942" y="834.2705739058447" width="239.15213632316042" height="60.729426094155315" style="stroke: red; fill: rgb(86, 106, 194); opacity: 0.538356;"></rect><rect x="491.42545454545456" y="70" width="66.42932143527327" height="225.21701419365547" style="stroke: red; fill: rgb(216, 163, 72); opacity: 0.545205;"></rect><rect x="562.8547759807278" y="70" width="103.2218894180296" height="225.21701419365547" style="stroke: red; fill: rgb(216, 163, 72); opacity: 0.632877;"></rect><rect x="491.42545454545456" y="300.2170141936555" width="174.65121085330287" height="157.99364604910807" style="stroke: red; fill: rgb(216, 163, 72); opacity: 0.678082;"></rect><rect x="491.42545454545456" y="463.21066024276354" width="174.65121085330298" height="69.59031259874439" style="stroke: red; fill: rgb(216, 163, 72); opacity: 0.513699;"></rect><rect x="686.0766653987574" y="70" width="115.54090530499377" height="224.21662186164002" style="stroke: red; fill: rgb(68, 207, 235); opacity: 0.656164;"></rect><rect x="806.6175707037512" y="70" width="104.3824292962488" height="224.21662186164002" style="stroke: red; fill: rgb(68, 207, 235); opacity: 0.630137;"></rect><rect x="686.0766653987574" y="299.21662186164" width="224.92333460124257" height="170.79129173424627" style="stroke: red; fill: rgb(68, 207, 235); opacity: 0.786301;"></rect><rect x="686.0766653987574" y="475.0079135958863" width="224.9233346012427" height="57.793059245621635" style="stroke: red; fill: rgb(68, 207, 235); opacity: 0.521918;"></rect><rect x="491.42545454545456" y="572.8009728415079" width="101.72207579886054" height="88.68058370490473" style="stroke: red; fill: rgb(197, 65, 128); opacity: 0.50137;"></rect><rect x="598.1475303443151" y="572.8009728415079" width="100.5651969284122" height="88.68058370490473" style="stroke: red; fill: rgb(197, 65, 128); opacity: 0.5;"></rect><rect x="703.7127272727273" y="572.8009728415079" width="101.72207579886049" height="88.68058370490473" style="stroke: red; fill: rgb(197, 65, 128); opacity: 0.50137;"></rect><rect x="810.4348030715878" y="572.8009728415079" width="100.5651969284122" height="88.68058370490473" style="stroke: red; fill: rgb(197, 65, 128); opacity: 0.5;"></rect><rect x="491.42545454545456" y="701.4815565464127" width="203.78102648102646" height="123.65813625350813" style="stroke: red; fill: rgb(14, 203, 126); opacity: 0.665753;"></rect><rect x="491.42545454545456" y="830.1396927999208" width="203.78102648102646" height="64.8603072000792" style="stroke: red; fill: rgb(14, 203, 126); opacity: 0.532877;"></rect><rect x="700.206481026481" y="701.4815565464127" width="145.60921375921373" height="193.51844345358734" style="stroke: red; fill: rgb(14, 203, 126); opacity: 0.69863;"></rect><rect x="850.8156947856947" y="701.4815565464127" width="60.184305214305255" height="193.51844345358734" style="stroke: red; fill: rgb(14, 203, 126); opacity: 0.515068;"></rect><text x="1" y="90" font-size="1rem" fill="white">男(千人)</text><text x="1" y="186.20020866824524" font-size="1rem" fill="white">女(千人)</text><text x="235.5535455941907" y="90" font-size="1rem" fill="white">總人數(千人)</text><text x="403.32702555509" y="90" font-size="1rem" fill="white">百分比(%)</text><text x="1" y="294.1751269035533" font-size="1rem" fill="white">男(千人)</text><text x="1" y="434.39922382640157" font-size="1rem" fill="white">女(千人)</text><text x="233.64474685883224" y="294.1751269035533" font-size="1rem" fill="white">總人數(千人)</text><text x="233.64474685883224" y="505.7036567090555" font-size="1rem" fill="white">百分比(%)</text><text x="1" y="602.7900652646846" font-size="1rem" fill="white">男(千人)</text><text x="1" y="750.676523422108" font-size="1rem" fill="white">女(千人)</text><text x="233.2733182222942" y="602.7900652646846" font-size="1rem" fill="white">總人數(千人)</text><text x="233.2733182222942" y="854.2705739058447" font-size="1rem" fill="white">百分比(%)</text><text x="492.42545454545456" y="90" font-size="1rem" fill="white">男(千人)</text><text x="563.8547759807278" y="90" font-size="1rem" fill="white">女(千人)</text><text x="492.42545454545456" y="320.2170141936555" font-size="1rem" fill="white">總人數(千人)</text><text x="492.42545454545456" y="483.21066024276354" font-size="1rem" fill="white">百分比(%)</text><text x="687.0766653987574" y="90" font-size="1rem" fill="white">男(千人)</text><text x="807.6175707037512" y="90" font-size="1rem" fill="white">女(千人)</text><text x="687.0766653987574" y="319.21662186164" font-size="1rem" fill="white">總人數(千人)</text><text x="687.0766653987574" y="495.0079135958863" font-size="1rem" fill="white">百分比(%)</text><text x="492.42545454545456" y="592.8009728415079" font-size="1rem" fill="white">男(千人)</text><text x="599.1475303443151" y="592.8009728415079" font-size="1rem" fill="white">女(千人)</text><text x="704.7127272727273" y="592.8009728415079" font-size="1rem" fill="white">總人數(千人)</text><text x="811.4348030715878" y="592.8009728415079" font-size="1rem" fill="white">百分比(%)</text><text x="492.42545454545456" y="721.4815565464127" font-size="1rem" fill="white">男(千人)</text><text x="492.42545454545456" y="850.1396927999208" font-size="1rem" fill="white">女(千人)</text><text x="701.206481026481" y="721.4815565464127" font-size="1rem" fill="white">總人數(千人)</text><text x="851.8156947856947" y="721.4815565464127" font-size="1rem" fill="white">百分比(%)</text><text x="1" y="105" font-size=".9rem" fill="white">91</text><text x="1" y="201.20020866824524" font-size=".9rem" fill="white">47</text><text x="235.5535455941907" y="105" font-size=".9rem" fill="white">138</text><text x="403.32702555509" y="105" font-size=".9rem" fill="white">10</text><text x="1" y="309.1751269035533" font-size=".9rem" fill="white">155</text><text x="1" y="449.39922382640157" font-size=".9rem" fill="white">143</text><text x="233.64474685883224" y="309.1751269035533" font-size=".9rem" fill="white">298</text><text x="233.64474685883224" y="520.7036567090555" font-size=".9rem" fill="white">23</text><text x="1" y="617.7900652646846" font-size=".9rem" fill="white">164</text><text x="1" y="765.676523422108" font-size=".9rem" fill="white">201</text><text x="233.2733182222942" y="617.7900652646846" font-size=".9rem" fill="white">365</text><text x="233.2733182222942" y="869.2705739058447" font-size=".9rem" fill="white">28</text><text x="492.42545454545456" y="105" font-size=".9rem" fill="white">33</text><text x="563.8547759807278" y="105" font-size=".9rem" fill="white">97</text><text x="492.42545454545456" y="335.2170141936555" font-size=".9rem" fill="white">130</text><text x="492.42545454545456" y="498.21066024276354" font-size=".9rem" fill="white">10</text><text x="687.0766653987574" y="105" font-size=".9rem" fill="white">114</text><text x="807.6175707037512" y="105" font-size=".9rem" fill="white">95</text><text x="687.0766653987574" y="334.21662186164" font-size=".9rem" fill="white">209</text><text x="687.0766653987574" y="510.0079135958863" font-size=".9rem" fill="white">16</text><text x="492.42545454545456" y="607.8009728415079" font-size=".9rem" fill="white">1</text><text x="599.1475303443151" y="607.8009728415079" font-size=".9rem" fill="white">0</text><text x="704.7127272727273" y="607.8009728415079" font-size=".9rem" fill="white">1</text><text x="811.4348030715878" y="607.8009728415079" font-size=".9rem" fill="white">0</text><text x="492.42545454545456" y="736.4815565464127" font-size=".9rem" fill="white">121</text><text x="492.42545454545456" y="865.1396927999208" font-size=".9rem" fill="white">24</text><text x="701.206481026481" y="736.4815565464127" font-size=".9rem" fill="white">145</text><text x="851.8156947856947" y="736.4815565464127" font-size=".9rem" fill="white">11</text><text x="1" y="56" font-size="1.1rem" fill="black">民意代表、主管及經理人員</text><text x="1" y="260.1751269035533" font-size="1.1rem" fill="black">專業人員</text><text x="1" y="568.7900652646846" font-size="1.1rem" fill="black">技術員及助理專業人員</text><text x="492.42545454545456" y="56" font-size="1.1rem" fill="black">事務支援人員</text><text x="687.0766653987574" y="56" font-size="1.1rem" fill="black">服務及銷售工作人員</text><text x="492.42545454545456" y="558.8009728415079" font-size="1.1rem" fill="black">農、林、漁、牧業生產人員</text><text x="492.42545454545456" y="687.4815565464127" font-size="1.1rem" fill="black">技藝有關工作人員、機械設備操作及勞力工</text></g></svg></div>


		<script>
			var Base64 = { _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", encode: function (r) { var t, e, o, a, h, c, n = "", d = 0; for (r = Base64._utf8_encode(r); d < r.length;)o = (c = r.charCodeAt(d++)) >> 2, a = (3 & c) << 4 | (t = r.charCodeAt(d++)) >> 4, h = (15 & t) << 2 | (e = r.charCodeAt(d++)) >> 6, c = 63 & e, isNaN(t) ? h = c = 64 : isNaN(e) && (c = 64), n = n + this._keyStr.charAt(o) + this._keyStr.charAt(a) + this._keyStr.charAt(h) + this._keyStr.charAt(c); return n }, decode: function (r) { var t, e, o, a, h, c = "", n = 0; for (r = r.replace(/[^A-Za-z0-9\+\/\=]/g, ""); n < r.length;)t = this._keyStr.indexOf(r.charAt(n++)) << 2 | (o = this._keyStr.indexOf(r.charAt(n++))) >> 4, e = (15 & o) << 4 | (a = this._keyStr.indexOf(r.charAt(n++))) >> 2, o = (3 & a) << 6 | (h = this._keyStr.indexOf(r.charAt(n++))), c += String.fromCharCode(t), 64 != a && (c += String.fromCharCode(e)), 64 != h && (c += String.fromCharCode(o)); return c = Base64._utf8_decode(c) }, _utf8_encode: function (r) { r = r.replace(/\r\n/g, "\n"); for (var t = "", e = 0; e < r.length; e++) { var o = r.charCodeAt(e); o < 128 ? t += String.fromCharCode(o) : (127 < o && o < 2048 ? t += String.fromCharCode(o >> 6 | 192) : (t += String.fromCharCode(o >> 12 | 224), t += String.fromCharCode(o >> 6 & 63 | 128)), t += String.fromCharCode(63 & o | 128)) } return t }, _utf8_decode: function (r) { for (var t = "", e = 0, o = c1 = c2 = 0; e < r.length;)(o = r.charCodeAt(e)) < 128 ? (t += String.fromCharCode(o), e++) : 191 < o && o < 224 ? (c2 = r.charCodeAt(e + 1), t += String.fromCharCode((31 & o) << 6 | 63 & c2), e += 2) : (c2 = r.charCodeAt(e + 1), c3 = r.charCodeAt(e + 2), t += String.fromCharCode((15 & o) << 12 | (63 & c2) << 6 | 63 & c3), e += 3); return t } };
		</script>

		<script>
			var csvData = null
			window.addEventListener('load', function(){
                var treemapContainer = document.getElementById('treemap')
                var objectKeys = document.getElementById("ObjectKeys")

                document.getElementById("ObjectKeys").addEventListener('change', function(evt){
					if(evt.target.value == 'selectValue' ){
						return;
					}
				
                    //clear container
                    if (treemapContainer.innerHTML.length) {
                        treemapContainer.innerHTML = ''
                    }


                    dataClassifier(objectKeys.value, function(data, layers){
                        node = getNode(data, layers, treemapContainer)
                        treemapContainer.appendChild(node)
                    })
				})

				document.getElementById('dropfile').addEventListener('dragover',function(evt){
					evt.preventDefault()
				})

				document.getElementById('dropfile').addEventListener('drop', function(evt){
					evt.preventDefault()

					var files = evt.dataTransfer.files

					if (files.length) {
                        if (treemapContainer.innerHTML.length) {
                            treemapContainer.innerHTML = ''
                        }

                        if (objectKeys.innerHTML.length) {
                            objectKeys.innerHTML = ''
						}

						var csvFile = files[0]

						//讀取csv
						var fr = new FileReader()

                        fr.onload = function(){
                            dataLoader(fr.result, function(){
								dataClassifier(objectKeys.value, function(data, layers){
									node = getNode(data, layers, treemapContainer)
									treemapContainer.innerHTML = node.innerHTML
								}) 
							})			                         
                        }

						fr.readAsText(csvFile)
					}
				})
			})
		</script>

	
	
</body></html>